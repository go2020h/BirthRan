<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>バスラン</title>
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/calendar.css">
  <link rel="stylesheet" href="css/responsive.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <!-- Supabaseクライアントライブラリ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* バブルキャンバス */
    #bubble-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 3; /* z-indexを上げて前面に表示 */
      display: block;
    }
    
    /* ヒーローセクション */
    #hero-section {
      position: relative;
      z-index: 0;
      margin-top: 0;
      margin-bottom: 0; /* 下のマージンを削除 */
      padding: 0;
      text-align: center;
      background-color: #16152e;
      overflow: hidden;
      height: auto; /* 明示的な高さを設定 */
      min-height: 200px;
      font-size: 0; /* テキストのサイズを0に設定 */
      line-height: 0; /* 行間を0に設定 */
      display: block;
    }
    
    /* ヒーローセクションの画像 */
    .hero-image {
      width: 100%;
      max-width: 1200px;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    
    #hero-section img {
      display: block;
      margin-bottom: 0;
    }
    
    /* コンテンツセクション */
    #con-wrap {
      position: relative;
      z-index: 5;
      overflow: hidden;
    }
    
    /* キャッチコピー */
    .catchcopy-wrapper {
      background: linear-gradient(135deg, #0a1525 0%, #1a3a6c 100%);
      padding: 40px 0;
      width: 100vw;
      position: relative;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
      text-align: center;
      box-sizing: border-box;
      overflow: hidden;
    }
    
    .catchcopy-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
      background: none;
      border: none;
      box-shadow: none;
    }
    
    .catchcopy-content {
      position: relative;
      background: none;
      border: none;
      box-shadow: none;
      padding: 0;
    }
    
    .catchcopy-wrapper h2 {
      color: #d4af37;
      font-size: 28px;
      margin: 15px 0;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      letter-spacing: 1px;
      font-weight: bold;
    }
    
    .catchcopy-wrapper h3 {
      color: #ffffff;
      font-size: 22px;
      margin: 20px 0;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      letter-spacing: 0.5px;
    }
    
    /* バブルスタイル */
    .bubble {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
    }
    
    @keyframes float {
      0% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-20px);
      }
      100% {
        transform: translateY(0);
      }
    }
    
    /* 番組情報 */
    .program-info {
      background-color: #f8f8f8;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      float: none;
      clear: both;
    }
    
    .program-info h2 {
      color: #0066cc;
      border-bottom: 2px solid #0066cc;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    /* 週間のハイライト */
    .weekly-highlight {
      margin-bottom: 40px;
    }
    
    .weekly-highlight h2 {
      color: #0066cc;
      border-bottom: 2px solid #0066cc;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    /* ゲスト */
    .guest {
      flex: 1;
      min-width: 300px;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .guest h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }
    
    .guest img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      background-color: #f0f0f0;
    }
    
    .guest p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    
    /* ランキング */
    .ranking {
      flex: 1;
      min-width: 300px;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .ranking h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }
    
    .ranking ol {
      padding-left: 25px;
      margin-bottom: 20px;
    }
    
    .ranking li {
      margin-bottom: 10px;
    }
    
    .ranking strong {
      font-weight: bold;
    }
    
    .ranking p {
      margin: 5px 0 0 0;
      font-size: 14px;
      color: #666;
    }
    
    /* 愛あるゲスト */
    .love-guest-section {
      margin-bottom: 40px;
    }
    
    .love-guest-section h2 {
      margin-bottom: 20px;
    }
    
    .love-guest-content {
      padding: 20px;
      background-color: #f8f8f8;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .love-guest-content h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }
    
    .love-guest-content p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    
    .love-guest-content ol {
      padding-left: 25px;
      margin-bottom: 20px;
    }
    
    .love-guest-content li {
      margin-bottom: 10px;
    }
    
    .love-guest-content strong {
      font-weight: bold;
    }
    
    /* プレゼント */
    .present-section {
      margin-bottom: 40px;
    }
    
    .present-section h2 {
      margin-bottom: 20px;
    }
    
    .present-content {
      padding: 20px;
      background-color: #f8f8f8;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .present-content h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }
    
    .present-content p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    
    /* メッセージボタン */
    .message-button-section {
      margin-bottom: 50px;
      text-align: center;
      padding: 30px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .message-text {
      color: #333333;
      font-size: 18px;
      line-height: 1.6;
      margin-bottom: 25px;
      text-align: center;
    }
    
    .message-button {
      display: inline-block;
      background-color: #ff4081;
      color: #ffffff;
      font-size: 18px;
      font-weight: bold;
      padding: 15px 30px;
      border-radius: 50px;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .message-button:hover {
      background-color: #ff5a92;
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    

    

    

    
    /* カレンダー */
    .calendar-wrapper {
      background: linear-gradient(to bottom, #e0f7fa 0%, #b2ebf2 100%);
      padding: 60px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      position: relative;
      overflow: hidden;
    }
    
    .calendar-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 70% 30%, rgba(77, 208, 225, 0.3) 0%, rgba(224, 247, 250, 0) 70%);
      pointer-events: none;
    }
    
    .calendar-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
      position: relative;
      z-index: 2;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .calendar-content {
      background: linear-gradient(to bottom, #f5f7fa 0%, #e2e7ed 100%);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    
    .calendar-content h2 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
      font-weight: bold;
      font-size: 32px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      letter-spacing: 1px;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 10px;
    }
    
    .calendar-header h3 {
      color: #2c3e50;
      font-size: 24px;
      font-weight: bold;
    }
    
    .calendar-nav-btn {
      background: rgba(52, 152, 219, 0.2);
      color: #2c3e50;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .calendar-nav-btn:hover {
      background: rgba(52, 152, 219, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      color: #34495e;
    }
    
    .weekdays div:first-child {
      color: #e74c3c; /* 日曜日色 */
    }
    
    .weekdays div:last-child {
      color: #3498db; /* 土曜日色 */
    }
    
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    
    .calendar-day {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      font-weight: 500;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.7);
      color: #34495e;
    }
    
    .calendar-day:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .calendar-day.empty {
      background: none;
      cursor: default;
    }
    
    .calendar-day.today {
      background-color: #3498db;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.5);
    }
    
    .calendar-day.broadcast-day {
      background-color: #2ecc71;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(46, 204, 113, 0.5);
    }
    
    .calendar-day.message-day {
      background-color: #9b59b6;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(155, 89, 182, 0.5);
    }
    
    .calendar-day.selected {
      background-color: #9b59b6;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(155, 89, 182, 0.5);
      transform: scale(1.1);
    }
    
    .calendar-legend {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 20px;
      display: none;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
    }
    
    .broadcast-day {
      background-color: #2ecc71;
    }
    
    .message-day {
      background-color: #9b59b6;
    }
    
    .legend-text {
      font-size: 16px;
      color: #34495e;
    }
    
    /* YouTube-LIVE */
    .youtube-wrapper {
      background: linear-gradient(to bottom, #0f2342 0%, #1e3c72 100%);
      padding: 60px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      position: relative;
      overflow: hidden;
    }
    
    .youtube-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 50%, rgba(25, 55, 109, 0.4) 0%, rgba(15, 35, 66, 0) 70%);
      pointer-events: none;
    }
    
    .youtube-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
      color: rgba(255, 255, 255, 0.9);
      position: relative;
      z-index: 2;
    }
    
    .youtube-section h2 {
      color: #d4af37;
      text-align: center;
      margin-bottom: 30px;
      font-weight: bold;
      font-size: 32px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      letter-spacing: 1px;
    }
    
    .youtube-container {
      position: relative;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
      transform: translateY(0);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .youtube-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.15);
    }
    
    .youtube-description {
      text-align: center;
      margin-top: 25px;
      font-size: 16px;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.8);
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* 番組概要 */
    .program-overview {
      margin-bottom: 40px;
      background-color: #e8f4fd;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    /* 番組情報 */
    .program-info {
      margin-bottom: 40px;
      background-color: #e0f7fa;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      float: none;
    }
    
    /* 週間のハイライト */
    .weekly-highlight {
      margin-bottom: 40px;
      background-color: #fff8e1;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    /* プレゼント */
    .present-section {
      margin-bottom: 40px;
      background-color: #f9fbe7;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    /* 出演者のリアルバイタルデータ */
    .vital-data-section {
      margin: 40px 0;
      background-color: #fce4ec;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    /* 全体 */
    body {
      font-family: 'Noto Sans JP', sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
      background-color: #f0f2f5;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* セクション共通スタイル */
    .section-wrapper {
      width: 100vw;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      box-sizing: border-box;
    }
    
    .section-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* キャッチコピースタイル */
    .catchcopy-wrapper {
      background: linear-gradient(135deg, #0a1525 0%, #1a3a6c 100%);
      padding: 40px 0;
      width: 100vw;
      position: relative;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
      text-align: center;
      box-sizing: border-box;
      overflow: hidden;
    }
    
    .catchcopy-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* カレンダースタイル */
    .calendar-wrapper {
      background-color: #f8f9fa;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .calendar-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* YouTube-LIVEスタイル */
    .youtube-wrapper {
      background-color: #1a3a6c;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .youtube-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
      color: #ffffff;
    }
    
    .youtube-section h2 {
      color: #d4af37;
      text-align: center;
      margin-bottom: 25px;
      font-weight: bold;
      font-size: 28px;
    }
    
    .youtube-container {
      position: relative;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
      overflow: hidden;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    /* 番組概要スタイル */
    .program-overview-wrapper {
      background-color: #e8f4fd;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .program-overview {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* 番組情報スタイル */
    .program-info-wrapper {
      background-color: #e0f7fa;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .program-info {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* 週間のハイライトスタイル */
    .weekly-highlight-wrapper {
      background-color: #fff8e1;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .weekly-highlight {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* プレゼントスタイル */
    .present-wrapper {
      background-color: #f9fbe7;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .present-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
    
    /* 出演者のリアルバイタルデータスタイル */
    .vital-data-wrapper {
      background-color: #fce4ec;
      padding: 40px 0;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }
    
    .vital-data-section {
      margin: 0 auto;
      max-width: 1200px;
      padding: 0 20px;
    }
  </style>
</head>
<body id="home">
  <!-- ヘッダープレースホルダー -->
  <div id="header-placeholder"></div>
  
  <!-- ヒーローセクション -->
  <div id="hero-section">
    <canvas id="bubble-canvas"></canvas>
    <img src="img/hero.png" alt="ヒーロー画像" class="hero-image">
  </div>
  
  <div id="con-wrap">
    <div id="con-body">
      <div class="wrap">
        <!-- キャッチコピー -->
        <div class="catchcopy-wrapper">
          <h2>毎日が誰かの誕生日☆彡</h2>
          <h3>最もバースデーメッセージが贈られたのは誰なのか♡</h3>
          <h2>『ウィークリー・バースデー・ランキング』</h2>
        </div>

        <!-- カレンダー -->
        <div class="calendar-wrapper">
          <div class="calendar-section">
            <div class="calendar-content">
              <h2>バスランカレンダー</h2>
              <div class="week-view">
                <h3 class="week-view-title">週間のバスラン</h3>
                <div class="week-days" id="week-days">
                  <!-- JavaScriptで動的に生成 -->
                </div>
              </div>
              <button class="view-calendar-btn" id="view-calendar-btn">
                <i class="fas fa-calendar-alt"></i> カレンダーを表示
              </button>
            </div>
          </div>
        </div>

        <!-- カレンダーポップアップ -->
        <div class="calendar-popup-overlay" id="calendar-popup-overlay">
          <div class="calendar-popup">
            <button class="calendar-popup-close" id="calendar-popup-close">
              <i class="fas fa-times"></i>
            </button>
            <h2>バスランカレンダー</h2>
            <div class="calendar-container">
              <div class="calendar-header">
                <button id="prev-month" class="calendar-nav-btn"><i class="fas fa-chevron-left"></i></button>
                <h3 id="current-month">2025年4月</h3>
                <button id="next-month" class="calendar-nav-btn"><i class="fas fa-chevron-right"></i></button>
              </div>
              <div class="weekdays">
                <div>日</div>
                <div>月</div>
                <div>火</div>
                <div>水</div>
                <div>木</div>
                <div>金</div>
                <div>土</div>
              </div>
              <div id="calendar-days" class="calendar-days">
                <!-- カレンダーの日付はJavaScriptで動的に生成 -->
              </div>
              <div class="calendar-legend" style="display: none;">
                <div class="legend-item">
                  <span class="legend-color broadcast-day"></span>
                  <span class="legend-text">放送日（毎週木曜日）</span>
                </div>
                <div class="legend-item">
                  <span class="legend-color message-day"></span>
                  <span class="legend-text">愛メッセージあり</span>
                </div>
              </div>
            </div>
          </div>
        </div>

               <!-- 週間ランキングセクション -->
               <div class="weekly-ranking-wrapper">
                <div class="weekly-ranking-section">
                  <h2 class="section-title">週間ランキング</h2>
                  <p class="section-description">先週の木曜から水曜までのメッセージのTop3を表示します</p>
                  
                  <!-- 曜日切り替えタブ -->
                  <div class="day-tabs">
                    <button class="day-tab" data-day="thu">木</button>
                    <button class="day-tab" data-day="fri">金</button>
                    <button class="day-tab" data-day="sat">土</button>
                    <button class="day-tab" data-day="sun">日</button>
                    <button class="day-tab" data-day="mon">月</button>
                    <button class="day-tab" data-day="tue">火</button>
                    <button class="day-tab" data-day="wed">水</button>
                  </div>
                  
                  <!-- ランキングコンテンツ -->
                  <div class="ranking-contents">
                    <!-- 木曜日のランキング -->
                    <div class="ranking-content" id="ranking-thu">
                      <h3 class="ranking-day-title">木曜日のランキング</h3>
                      <div class="ranking-list">
                        <div class="ranking-item">
                          <div class="ranking-number">1</div>
                          <div class="ranking-info">
                            <div class="ranking-author">松田和佳</div>
                            <div class="ranking-message">私は小さい頃から歌うのが大好きでした。</div>
                            <div class="ranking-date">2025/3/21</div>
                          </div>
                        </div>
                        <div class="ranking-item">
                          <div class="ranking-number">2</div>
                          <div class="ranking-info">
                            <div class="ranking-author">神谷明采</div>
                            <div class="ranking-message">私は大学院で心理学を専攻しています。</div>
                            <div class="ranking-date">2025/3/21</div>
                          </div>
                        </div>
                        <div class="ranking-item">
                          <div class="ranking-number">3</div>
                          <div class="ranking-info">
                            <div class="ranking-author">宮崎美穂</div>
                            <div class="ranking-message">私はAKB48で活動していたときが一番楽しかったです。</div>
                            <div class="ranking-date">2025/3/21</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- 金曜日のランキング -->
                    <div class="ranking-content" id="ranking-fri" style="display: none;">
                      <h3 class="ranking-day-title">金曜日のランキング</h3>
                      <div class="ranking-list">
                        <div class="ranking-item">
                          <div class="ranking-number">1</div>
                          <div class="ranking-info">
                            <div class="ranking-author">ユウニャン</div>
                            <div class="ranking-message">私は猫が大好きで、猫カフェによく行きます。</div>
                            <div class="ranking-date">2025/3/22</div>
                          </div>
                        </div>
                        <div class="ranking-item">
                          <div class="ranking-number">2</div>
                          <div class="ranking-info">
                            <div class="ranking-author">ChumuNote</div>
                            <div class="ranking-message">私はVTuberとして活動しています。</div>
                            <div class="ranking-date">2025/3/22</div>
                          </div>
                        </div>
                        <div class="ranking-item">
                          <div class="ranking-number">3</div>
                          <div class="ranking-info">
                            <div class="ranking-author">風谷南友</div>
                            <div class="ranking-message">私は女優として活動しています。</div>
                            <div class="ranking-date">2025/3/22</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- 他の曜日のランキングも同様に追加 -->
                    <!-- 土曜日のランキング -->
                    <div class="ranking-content" id="ranking-sat" style="display: none;">
                      <h3 class="ranking-day-title">土曜日のランキング</h3>
                      <div class="ranking-list">
                        <!-- ランキングアイテム -->
                      </div>
                    </div>
                    
                    <!-- 日曜日のランキング -->
                    <div class="ranking-content" id="ranking-sun" style="display: none;">
                      <h3 class="ranking-day-title">日曜日のランキング</h3>
                      <div class="ranking-list">
                        <!-- ランキングアイテム -->
                      </div>
                    </div>
                    
                    <!-- 月曜日のランキング -->
                    <div class="ranking-content" id="ranking-mon" style="display: none;">
                      <h3 class="ranking-day-title">月曜日のランキング</h3>
                      <div class="ranking-list">
                        <!-- ランキングアイテム -->
                      </div>
                    </div>
                    
                    <!-- 火曜日のランキング -->
                    <div class="ranking-content" id="ranking-tue" style="display: none;">
                      <h3 class="ranking-day-title">火曜日のランキング</h3>
                      <div class="ranking-list">
                        <!-- ランキングアイテム -->
                      </div>
                    </div>
                    
                    <!-- 水曜日のランキング -->
                    <div class="ranking-content" id="ranking-wed" style="display: none;">
                      <h3 class="ranking-day-title">水曜日のランキング</h3>
                      <div class="ranking-list">
                        <!-- ランキングアイテム -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

        <!-- YouTube-LIVE -->
        <div id="youtube-section" class="youtube-wrapper" style="transition: none !important; transform: none !important;">
          <div class="youtube-section" style="transition: none !important; transform: none !important;">
            <h2>YouTube-LIVE</h2>
            <div class="youtube-container" style="transition: none !important; transform: none !important;">
              <div class="youtube-video" style="transition: none !important; transform: none !important;">
                <p style="text-align: center; margin-bottom: 5px; font-weight: bold;">渋谷愛ビジョン</p>
                <iframe width="100%" height="400" src="https://www.youtube.com/embed/six6fVA6Gxo?modestbranding=1&showinfo=0&rel=0" title="【LIVE】渋谷愛ビジョン・宮益坂交差点ライブカメラ／『SHIBUYA AI Vision』Miyamasuzaka-Shibuya" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
              </div>
              <div class="youtube-video" style="transition: none !important; transform: none !important;">
                <p style="text-align: center; margin-bottom: 5px; font-weight: bold;">渋谷愛ビジョンの眼</p>
                <iframe width="100%" height="400" src="https://www.youtube.com/embed/frp2DX9D3tc?modestbranding=1&showinfo=0&rel=0" title="【LIVE】渋谷愛ビジョン・宮益坂交差点ライブカメラ／SHIBUYA AI Vision" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
              </div>
            </div>
            
            <!-- メッセージボタン -->
            <div class="message-button-section" style="background: transparent; box-shadow: none;">
              <div class="message-content">
                <div class="message-text" style="color: #ffffff; text-align: center;">
                  <p style="border-bottom: 3px solid gold; display: inline-block; padding-bottom: 0px; margin-bottom: 10px;"><strong>大好きな人、大切なひとへ、</strong></p><br>
                  <p style="border-bottom: 3px solid gold; display: inline-block; padding-bottom: 0px; margin-bottom: 10px;"><strong>おめでとう、ありがとうの</strong></p><br>
                  <p style="border-bottom: 3px solid gold; display: inline-block; padding-bottom: 0px; margin-bottom: 10px;"><strong>メッセージを贈ろう</strong></p>
                </div>
                <a href="https://ec.saivision.jp/" target="_blank" class="btn-message" style="background-color: #ff4081; color: #ffffff;">メッセージを送る <i class="fas fa-paper-plane"></i></a>
              </div>
            </div>
          </div>
        </div>

        <!-- 番組の概要 -->
        <div class="intro-section-wrapper">
          <div class="container">
            <h2 class="section-title">番組の概要</h2>
            <div class="program-introduction">
              <div class="intro-container">
                <div class="intro-image">
                  <img src="img/about1.jpg" alt="efitプレゼンツ☆ウィークリー・バースデー・ランキング" class="main-image">
                </div>
                <div class="intro-content">
                  <h3 class="intro-title">新しいラジオの形を創造する</h3>
                  <p class="intro-text">「efitプレゼンツ☆ウィークリー・バースデー・ランキング」は、ラジオと渋谷愛ビジョンが連動する新しいクロスメディア番組です。毎週木曜日、ラジオ日本神谷町スタジオから生放送でお届けします。</p>
                  <div class="program-details">
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-calendar-alt"></i></span>
                      <span class="detail-text">放送開始：2025年4月3日（木曜日）</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-clock"></i></span>
                      <span class="detail-text">放送時間：毎週木曜日 18:00～20:30</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-broadcast-tower"></i></span>
                      <span class="detail-text">放送局：ラジオ日本</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 次回のゲスト -->
        <div style="background-color: #1a3a6c; color: white; width: 100vw; position: relative; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; padding: 60px 0;">
          <div class="container">
            <h2 class="section-title" style="color: #d4af37;">次回のゲスト</h2>
            <div class="program-introduction">
              <div class="intro-container" style="background-color: transparent; border: none; box-shadow: none;">
                <div class="intro-image">
                  <img src="img/cast/cast3.jpg" alt="神谷明采" class="main-image">
                </div>
                <div class="intro-content">
                  <h3 class="intro-title" style="color: #1a3a6c;">神谷明采</h3>
                  <p class="intro-text" style="color: #333;">東京大学大学院生。知的で洞察力のある視点からのトーク、番組に深みを与えています。</p>
                  <div class="program-details">
                    <div class="detail-item">
                      <span class="detail-icon" style="background-color: rgba(26, 58, 108, 0.2); color: #1a3a6c;"><i class="fas fa-birthday-cake"></i></span>
                      <span class="detail-text" style="color: #333;">誕生日：4月19日</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon" style="background-color: rgba(26, 58, 108, 0.2); color: #1a3a6c;"><i class="fas fa-calendar-day"></i></span>
                      <span class="detail-text" style="color: #333;">出演日：4月3日</span>
                    </div>
                  </div>
                  <div style="text-align: center; margin-top: 20px;">
                    <a href="caststaff.html" class="btn-primary" style="background-color: #1a3a6c; border: none; display: inline-block;">出演者情報を確認する</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 51FA8005 -->
        <div class="intro-section-wrapper">
          <div class="container">
            <h2 class="section-title">出演者のリアルバイタルデータ</h2>
            <div class="program-introduction">
              <div class="intro-container">
 
                <div class="intro-content">
                  <h3 class="intro-title">MOTHER Bracelet</h3>
                  <p class="intro-text">MOTHER Braceletは、体温で充電、充電不要で計測可能でバイタルデータを蓄積する健康チェックデバイスです。</p>
                  <div class="program-details">
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-heartbeat"></i></span>
                      <span class="detail-text">心拍数、睡眠の質、ストレスレベルなどを計測</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-battery-full"></i></span>
                      <span class="detail-text">体温で充電、充電不要で計測可能</span>
                    </div>
                    <div class="detail-item">
                      <span class="detail-icon"><i class="fas fa-chart-line"></i></span>
                      <span class="detail-text">健康データを蓄積し、分析</span>
                    </div>
                  </div>
                  <div style="text-align: center; margin-top: 20px;">
                    <a href="news.html" class="btn-primary" style="display: inline-block;">詳細を見る <i class="fas fa-arrow-right"></i></a>
                  </div>                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 誕生日が近い！ゲスト募集中！！ -->
  <div class="intro-section-wrapper" style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f2ff 100%); padding: 60px 0; border-top: 3px solid #1a3a6c; border-bottom: 3px solid #1a3a6c;"> 
    <div class="container">
      <h2 class="section-title" style="color: #1a3a6c; text-align: center; font-size: 32px; margin-bottom: 30px; position: relative;">
        <i class="fas fa-birthday-cake" style="margin-right: 10px; color: #d4af37;"></i>誕生日が近い！ゲスト募集中！！
      </h2>
      <div class="program-introduction" style="max-width: 1000px; margin: 0 auto;">
        <div class="intro-container" style="background-color: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(26, 58, 108, 0.15); overflow: hidden;">
        
          <div class="intro-content" style="padding: 30px;">
            <p class="intro-text" style="font-size: 18px; text-align: center; color: #333; margin-bottom: 25px; font-weight: 500;">番組では、誕生日が近いゲストを大募集しています。</p>
            <div class="program-details" style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px;">
              <div class="detail-item" style="display: flex; align-items: center; margin-bottom: 15px;">
                <span class="detail-icon" style="background-color: #1a3a6c; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 15px;"><i class="fas fa-calendar-check"></i></span>
                <span class="detail-text" style="font-size: 16px; color: #333;">出演日から１か月以内に誕生日を迎える方</span>
              </div>
              <div class="detail-item" style="display: flex; align-items: center;">
                <span class="detail-icon" style="background-color: #1a3a6c; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 15px;"><i class="fas fa-trophy"></i></span>
                <span class="detail-text" style="font-size: 16px; color: #333;">バスランでベスト３に入ると自負している方</span>
              </div>
            </div>
            <h4 style="margin-top: 20px; color: #1a3a6c; font-size: 20px; text-align: center; padding-bottom: 10px; border-bottom: 2px solid #d4af37; margin-bottom: 20px;">ゲスト出演してくださった方には、誕生日プレゼントとして</h4>
            <ol class="present-list" style="padding-left: 20px; margin-bottom: 25px;">
              <li style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #e0e0e0;">
                <strong style="color: #1a3a6c; font-size: 18px; display: block; margin-bottom: 5px;">渋谷愛ビジョンの放映枠</strong>
                <p style="margin: 0; color: #555; line-height: 1.6;">20時00分30秒～20時5分00秒（4分30秒間）を1週間無償でご提供させていただきます。<br>
                ミュージックビデオや映画・ドラマのPRはもちろんのこと、自らが発信したい映像を放映して渋谷で注目を浴びましょう。</p>
              </li>
              <li style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dashed #e0e0e0;">
                <strong style="color: #1a3a6c; font-size: 18px; display: block; margin-bottom: 5px;">MOTHER Bracelet</strong>
                <p style="margin: 0; color: #555; line-height: 1.6;">体温で充電、充電不要で計測可能でバイタルデータを蓄積するMOTHER　Braceletで健康チェック。</p>
              </li>
              <li style="margin-bottom: 15px;">
                <strong style="color: #1a3a6c; font-size: 18px; display: block; margin-bottom: 5px;">今月のバースデープレゼント</strong>
                <p style="margin: 0; color: #555; line-height: 1.6;">毎月どんな商品をセレクトするのか！？お楽しみに～。</p>
              </li>
            </ol>
            <p style="margin-top: 15px; text-align: center; font-weight: 500; color: #333; font-size: 16px;">以上、愛が詰まった３つのサービス＆商品をプレゼントさせていただきます。</p>
            <div style="text-align: center; margin-top: 30px;">
              <a href="#" class="btn-primary" style="display: inline-block; background: linear-gradient(135deg, #1a3a6c 0%, #0f2a5c 100%); border: none; padding: 15px 30px; font-size: 18px; border-radius: 50px; box-shadow: 0 5px 15px rgba(26, 58, 108, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(26, 58, 108, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(26, 58, 108, 0.3)'">応募する <i class="fas fa-arrow-right"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- フッター -->
  <div id="footer-placeholder"></div>

  <script>
    // 現在の日付を取得
    const today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let selectedDate = today;
    
    // バブルアニメーションの初期化関数
    function initBubbles() {
      const canvas = document.getElementById('bubble-canvas');
      if (!canvas) return; // キャンバスが存在しない場合は処理を終了
      
      const ctx = canvas.getContext('2d');
      
      // キャンバスサイズをウィンドウサイズに合わせる
      function resizeCanvas() {
        const heroSection = document.getElementById('hero-section');
        if (heroSection) {
          canvas.width = heroSection.offsetWidth;
          canvas.height = heroSection.offsetHeight;
          console.log('Canvas resized to:', canvas.width, 'x', canvas.height);
        }
      }
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      
      // バブルの設定
      const bubbles = [];
      // バブルの数を画面サイズに応じて調整
      const bubbleCount = Math.floor((canvas.width + canvas.height) * 0.02); // バブルの数を減らす
      
      console.log('Creating', bubbleCount, 'bubbles');
      
      // バブルを生成
      for (let i = 0; i < bubbleCount; i++) {
        const size = Math.random() < 0.4 ? 
                  Math.random() * 40 + 20 : // 小さいバブル (40%)
                  Math.random() < 0.7 ? 
                    Math.random() * 60 + 50 : // 中くらいのバブル (42%)
                    Math.random() * 100 + 100; // 大きいバブル (18%)
        
        bubbles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: size / 2,
          // バブルの色を変更
          color: `rgba(255, 255, 255, ${0.2 + Math.random() * 0.3})`, // 不透明度を変更
          angle: Math.random() * Math.PI * 2, // 移動方向
          speed: 0.2 + Math.random() * 0.6,   // 移動速度を増やす
          rotationSpeed: (Math.random() - 0.5) * 0.02, // 回転速度を増やす
          opacity: 0.3 + Math.random() * 0.4  // 不透明度を変更
        });
      }
      
      // アニメーションループ
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 各バブルを描画・更新
        bubbles.forEach(bubble => {
          // バブルを描画（輪郭をぼかす）
          ctx.beginPath();
          ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);
          
          // ぼかし効果を追加
          ctx.shadowColor = 'rgba(255, 255, 255, 0.8)';
          ctx.shadowBlur = bubble.radius * 0.8;
          
          ctx.fillStyle = bubble.color;
          ctx.globalAlpha = bubble.opacity;
          ctx.fill();
          
          // バブルの位置を更新
          bubble.x += Math.cos(bubble.angle) * bubble.speed;
          bubble.y += Math.sin(bubble.angle) * bubble.speed;
          
          // バブルの角度をわずかに変化させる（より自然な動き）
          bubble.angle += bubble.rotationSpeed;
          
          // 画面外に出たバブルを反対側から再登場させる
          if (bubble.x - bubble.radius > canvas.width) {
            bubble.x = -bubble.radius;
          } else if (bubble.x + bubble.radius < 0) {
            bubble.x = canvas.width + bubble.radius;
          }
          
          if (bubble.y - bubble.radius > canvas.height) {
            bubble.y = -bubble.radius;
          } else if (bubble.y + bubble.radius < 0) {
            bubble.y = canvas.height + bubble.radius;
          }
        });
        
        requestAnimationFrame(animate);
      }
      
      animate();
    }
    
    // 日付をYYYY-MM-DD形式にフォーマットする関数
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }
    
    // 日付をYYYY-MM-DD形式にフォーマットする関数
    function formatDisplayDate(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const dayOfWeek = ['日', '月', '火', '水', '木', '金', '土'][date.getDay()];
      return `${year}年${month}月${day}日(${dayOfWeek})`;
    }
    
    // カレンダーを初期化する関数
    async function initCalendar() {
      console.log('initCalendar called');
      try {
        // u9031u9593u30d5u30fcu30bfu3092u5148u306bu623bu3057u3001u30d0u30b9u30e9u30f3u3092u8868u793a
        await renderWeekView();
        await renderCalendar(currentYear, currentMonth);
        setupPopupEvents();
        console.log('Calendar initialization completed');
      } catch (err) {
        console.error('Error initializing calendar:', err);
      }
    }
    
    // 月を変更する関数
    function changeMonth(delta) {
      currentMonth += delta;
      
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      
      renderCalendar(currentYear, currentMonth);
    }
    
    // 週間のバスランを表示する関数
    async function renderWeekView() {
      console.log('renderWeekView called');
      const weekDays = $("#week-days");
      weekDays.empty();
      
      // u672cu65e5u3092u4e00u756au4e0bu306bu3057u3066u904eu53bb6u65e5u3092u8868u793a
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - 6); // u672cu65e5u304bu3089u30556u65e5u524d
      
      console.log('Week start date:', startOfWeek);
      
      // Supabaseu304bu3089u30c7u30fcu30bfu3092u53d6u5f97
      const SUPABASE_URL = 'https://cdpthzwwczpwlypadhbz.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkcHRoend3Y3pwd2x5cGFkaGJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI3ODc2NzYsImV4cCI6MjA1ODM2MzY3Nn0.woIzlcCR94Niz-WelVqmweSPFqUlTmONrqxTrXl4_z0';
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      
      const weekStart = formatDate(startOfWeek);
      const weekEnd = formatDate(today); // u672cu65e5u307eu3067
      
      console.log('Week date range:', weekStart, 'to', weekEnd);
      
      try {
        const { data: weekMessages, error } = await supabase
          .from('calendar_comments')
          .select('comment_date, author_name, comment_text')
          .gte('comment_date', weekStart)
          .lte('comment_date', weekEnd)
          .order('created_at', { ascending: false });
        
        if (error) {
          console.error('Error fetching week messages:', error);
          return;
        }
        
        console.log('Week messages:', weekMessages);
        
        // u30c7u30fcu30bfu3092u65e5u4ed8u3054u3068u306bu6574u7406
        const messagesByDate = {};
        if (weekMessages && Array.isArray(weekMessages)) {
          weekMessages.forEach(message => {
            const date = message.comment_date.split('T')[0];
            if (!messagesByDate[date]) {
              messagesByDate[date] = [];
            }
            messagesByDate[date].push(message);
          });
        }
        
        console.log('Messages by date:', messagesByDate);
        
        // u9031u9593u30d5u30fcu30bfu3092u65e5u4ed8u3054u3068u306bu6574u7406
        const dayNames = ['日', '月', '火', '水', '木', '金', '土'];
        
        for (let i = 0; i <= 6; i++) {
          const currentDate = new Date(startOfWeek);
          currentDate.setDate(startOfWeek.getDate() + i);
          const formattedDate = formatDate(currentDate);
          const dayOfWeek = dayNames[currentDate.getDay()];
          const dayNumber = currentDate.getDate();
          const dayOfWeekIndex = currentDate.getDay(); // u66fcu65e5u306eu30a4u30f3u30c7u30c3u30afu30b7u30e7u30f3 (0-6)
          
          console.log('Creating day element:', formattedDate, dayOfWeek, dayNumber);
          
          // u30d0u30d6u30ebu306eu8272u3092u5909u66f4
          let dayClass = "week-day";
          if (currentDate.getFullYear() === today.getFullYear() && 
              currentDate.getMonth() === today.getMonth() && 
              currentDate.getDate() === today.getDate()) {
            dayClass += " today";
          }
          
          // u6728u66dcu65e5u306fu653eu9001u65e5u306eu30afu30e9u30b9u3092u524au9664
          // if (currentDate.getDay() === 4) { // u6728u66dc u65e5
          //   dayClass += " broadcast";
          // }
          
          // u30e1u30c3u30bbu30fcu30b8u304cu308bu5834u5408u306eu30afu30e9u30b9u3092u524au9664
          // if (messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0) {
          //   dayClass += " message-day";
          // }
          
          const weekDayElement = $(`
            <div class="${dayClass}" data-date="${formattedDate}" data-day="${dayOfWeekIndex}">
              <div class="week-day-number">${dayNumber}</div>
              <div class="week-day-name">${dayOfWeek}</div>
              <div class="week-day-message">${messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0 ? `<span class="author-name">${messagesByDate[formattedDate][0].author_name}:</span><span class="comment-text">${messagesByDate[formattedDate][0].comment_text}</span>` : ''}</div>
            </div>
          `);
          
          weekDays.append(weekDayElement);
        }
        
        // バブルをクリックしたときのイベント
        $(".week-day").click(function() {
          const dateStr = $(this).data("date");
          const dateParts = dateStr.split("-");
          selectedDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
          
          // カレンダーポップアップを表示
          $("#calendar-popup-overlay").css("display", "flex").hide().fadeIn(300);
          
          // カレンダーを更新
          currentYear = selectedDate.getFullYear();
          currentMonth = selectedDate.getMonth();
          renderCalendar(currentYear, currentMonth);
        });
      } catch (err) {
        console.error('Error in renderWeekView:', err);
      }
    }
    
    // カレンダーポップアップのイベントを設定
    function setupPopupEvents() {
      console.log('Setting up popup events');
      
      // カレンダーポップアップを表示
      $("#view-calendar-btn").click(function() {
        console.log('Calendar button clicked');
        $("#calendar-popup-overlay").css("display", "flex").hide().fadeIn(300);
      });
      
      // カレンダーポップアップを閉じる
      $("#calendar-popup-close").click(function() {
        console.log('Close button clicked');
        $("#calendar-popup-overlay").fadeOut(300);
      });
      
      // カレンダーポップアップの背景をクリックしたとき
      $("#calendar-popup-overlay").click(function(e) {
        if (e.target === this) {
          console.log('Overlay background clicked');
          $(this).fadeOut(300);
        }
      });
    }
    
    // カレンダーを描画する関数
    async function renderCalendar(year, month) {
      console.log(`Rendering calendar for ${year}/${month+1}`);
      const monthNames = ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"];
      $("#current-month").text(year + "年" + monthNames[month]);
      
      const calendarDays = $("#calendar-days");
      calendarDays.empty();
      
      // 月の初日を取得
      const firstDay = new Date(year, month, 1).getDay();
      
      // 月の日数を取得
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      // Supabaseu304bu3089u30c7u30fcu30bfu3092u53d6u5f97
      try {
        const SUPABASE_URL = 'https://cdpthzwwczpwlypadhbz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkcHRoend3Y3pwd2x5cGFkaGJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI3ODc2NzYsImV4cCI6MjA1ODM2MzY3Nn0.woIzlcCR94Niz-WelVqmweSPFqUlTmONrqxTrXl4_z0';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const monthStart = formatDate(new Date(year, month, 1));
        const monthEnd = formatDate(new Date(year, month + 1, 0));
        
        console.log(`Fetching calendar data from ${monthStart} to ${monthEnd}`);
        
        const { data: monthMessages, error } = await supabase
          .from('calendar_comments')
          .select('comment_date, author_name, comment_text')
          .gte('comment_date', monthStart)
          .lte('comment_date', monthEnd)
          .order('created_at', { ascending: false });
          
        if (error) {
          console.error('Error fetching month messages:', error);
        } else {
          console.log('Month messages:', monthMessages);
          
          // u30c7u30fcu30bfu3092u65e5u4ed8u3054u3068u306bu6574u7406
          const messagesByDate = {};
          if (monthMessages && Array.isArray(monthMessages)) {
            monthMessages.forEach(message => {
              const date = message.comment_date.split('T')[0];
              if (!messagesByDate[date]) {
                messagesByDate[date] = [];
              }
              messagesByDate[date].push(message);
            });
          }
          
          console.log('Messages by date:', messagesByDate);
          
          // 前月の日数を表示
          for (let i = 0; i < firstDay; i++) {
            calendarDays.append('<div class="calendar-day empty"></div>');
          }
          
          // 当月の日数を表示
          for (let i = 1; i <= daysInMonth; i++) {
            const currentDate = new Date(year, month, i);
            const formattedDate = formatDate(currentDate);
            
            let dayClass = "calendar-day";
            if (currentDate.getFullYear() === today.getFullYear() && 
                currentDate.getMonth() === today.getMonth() && 
                currentDate.getDate() === today.getDate()) {
              dayClass += " today";
            }
            
            // u6728u66dcu65e5u306fu653eu9001u65e5u306eu30afu30e9u30b9u3092u524au9664
            // if (currentDate.getDay() === 4) { // u6728u66dc u65e5
            //   dayClass += " broadcast";
            // }
            
            // u30e1u30c3u30bbu30fcu30b8u304cu308bu5834u5408u306eu30afu30e9u30b9u3092u524au9664
            // if (messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0) {
            //   dayClass += " message-day";
            // }
            
            const dayElement = $(`
              <div class="${dayClass}" data-date="${formattedDate}" style="border-radius: 0 !important;">
                <div class="day-number">${i}</div>
                ${messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0 ? `<div class="love-message" style="border-radius: 0 !important;"><span class="author-name">${messagesByDate[formattedDate][0].author_name}:</span><span class="comment-text">${messagesByDate[formattedDate][0].comment_text}</span></div>` : ''}
              </div>
            `);
            
            dayElement.click(function() {
              selectedDate = new Date(year, month, i);
              $(".calendar-day").removeClass("selected");
              $(this).addClass("selected");
              
              // カレンダーを更新
              renderCalendar(year, month);
            });
            
            calendarDays.append(dayElement);
          }
          
          // 空白を埋める
          const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
          for (let i = firstDay + daysInMonth; i < totalCells; i++) {
            calendarDays.append('<div class="calendar-day empty"></div>');
          }
        }
      } catch (err) {
        console.error('Error rendering calendar:', err);
      }
    }
    
    // ドキュメントが読み込まれたとき
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded event fired');
      initBubbles();
      
      // u9031u9593u30d0u30b9u30e9u30f3u304cu8868u793au3055u308cu308bu3088u3046u306bu4feeu6b63u3057u307eu3059u3002
      const weekDays = document.getElementById('week-days');
      if (weekDays) {
        console.log('week-days element found, creating default week view');
        // u73feu5728u306eu65e5u4ed8u3092u53d6u5f97
        const today = new Date();
        const startOfWeek = new Date(today);
        startOfWeek.setDate(today.getDate() - today.getDay()); // u9031u9593u306eu521du65e5u3092u53d6u5f97
        
        // u9031u9593u306eu30cfu30a4u30e9u30a4u30c8
        const dayNames = ['u65e5', 'u6708', 'u706b', 'u6c34', 'u6728', 'u91d1', 'u571f'];
        
        for (let i = 0; i < 7; i++) {
          const currentDate = new Date(startOfWeek);
          currentDate.setDate(startOfWeek.getDate() + i);
          const formattedDate = formatDate(currentDate);
          const dayOfWeek = dayNames[currentDate.getDay()];
          const dayNumber = currentDate.getDate();
          
          console.log('Creating day element:', formattedDate, dayOfWeek, dayNumber);
          
          // u30d0u30d6u30ebu306eu8272u3092u5909u66f4
          let dayClass = "week-day";
          if (currentDate.getFullYear() === today.getFullYear() && 
              currentDate.getMonth() === today.getMonth() && 
              currentDate.getDate() === today.getDate()) {
            dayClass += " today";
          }
          
          // u6728u66dcu65e5u306fu653eu9001u65e5u306eu30afu30e9u30b9u3092u524au9664
          // if (currentDate.getDay() === 4) { // u6728u66dc u65e5
          //   dayClass += " broadcast";
          // }
          
          // u30d0u30d6u30ebu306eu8272u3092u5909u66f4
          if (messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0) {
            dayClass += " has-message";
          }
          
          // u30e1u30c3u30bbu30fcu30b8u3092u53d6u5f97
          let messageText = '';
          if (messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0) {
            messageText = messagesByDate[formattedDate][0].comment_text;
          }
          
          // u30d0u30d6u30ebu3092u63cfu753b
          const weekDayElement = $(`
            <div class="${dayClass}" data-date="${formattedDate}">
              <div class="week-day-number">${dayNumber}</div>
              <div class="week-day-name">${dayOfWeek}</div>
              <div class="week-day-message"><span class="author-name">${messagesByDate[formattedDate] && messagesByDate[formattedDate].length > 0 ? messagesByDate[formattedDate][0].author_name : ''}:</span><span class="comment-text">${messageText}</span></div>
            </div>
          `);
          
          weekDays.append(weekDayElement);
        }
      } else {
        console.error('week-days element not found!');
      }
    });
    
    $(document).ready(function() {
      // バブルアニメーションを初期化
      initBubbles();
      
      // カレンダーを初期化
      initCalendar();
      
      // 前月ボタンをクリックしたとき
      $("#prev-month").click(function() {
        changeMonth(-1);
      });
      
      // 次月ボタンをクリックしたとき
      $("#next-month").click(function() {
        changeMonth(1);
      });
      
      // カレンダーポップアップの表示・非表示
      $('#view-calendar-btn').click(function() {
        $('#calendar-popup-overlay').fadeIn(300);
      });
      
      $('#calendar-popup-close').click(function() {
        $('#calendar-popup-overlay').fadeOut(300);
      });
      
      // 週間ランキングのタブ切り替え
      $('.day-tab').click(function() {
        const day = $(this).data('day');
        
        // タブのアクティブ状態を切り替え
        $('.day-tab').removeClass('active');
        $(this).addClass('active');
        
        // コンテンツの表示を切り替え
        $('.ranking-content').hide();
        $(`#ranking-${day}`).show();
      });
      
      // 現在の曜日に対応するタブをアクティブにする
      function setDefaultActiveTab() {
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0: 日曜日, 1: 月曜日, ..., 6: 土曜日
        
        // 曜日に対応するタブのdata-day値
        const dayMap = {
          0: 'sun', // 日曜日
          1: 'mon', // 月曜日
          2: 'tue', // 火曜日
          3: 'wed', // 水曜日
          4: 'thu', // 木曜日
          5: 'fri', // 金曜日
          6: 'sat'  // 土曜日
        };
        
        const defaultDay = dayMap[dayOfWeek];
        $(`.day-tab[data-day="${defaultDay}"]`).click();
      }
      
      // ページ読み込み時に実行
      setDefaultActiveTab();
    });
  </script>
  <script src="js/header.js"></script>
  <script src="js/script.js"></script>
  <script src="js/footer.js"></script>
</body>
</html>
